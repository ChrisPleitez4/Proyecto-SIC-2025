{% extends "base.html" %}
{% block title %}Libro mayor{% endblock %}
{% load static %}
{% block content %}

<link rel="stylesheet" href="{% static 'css/libromayor.css' %}">

<div class="container mt-4 libro-mayor-app">
    <h2 class="text-center mb-4">Libro Mayor</h2>

    {% for tipo in data %}
        <h3 class="mt-4">{{ tipo.tipo.codTipoCuenta }} - {{ tipo.tipo.nombreRubro }}</h3>

        {% for subtipo in tipo.subtipos %}
            <h5 class="ms-3">{{ subtipo.subtipo.codSubTipoCuenta }} - {{ subtipo.subtipo.nombreSubCuenta }}</h5>

            {% for cuenta_data in subtipo.cuentas %}
            <div class="card mb-3 shadow-sm ms-4">
                <div class="card-header bg-primary text-white">
                    <strong>{{ cuenta_data.cuenta.codCuenta }} - {{ cuenta_data.cuenta.nombreCuenta }}</strong>
                </div>
                <div class="card-body">
                    <table class="table table-striped table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Código</th>
                                <th>Fecha</th>
                                <th>Debe</th>
                                <th>Haber</th>
                                <th>Saldo</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for m in cuenta_data.movimientos %}
                            <tr>
                                <td>{{ m.codigo }}</td>
                                <td>{{ m.fecha }}</td>
                                <td>{{ m.debe }}</td>
                                <td>{{ m.haber }}</td>
                                <td>{{ m.saldo }}</td>
                                <td>
                                    <button class="btn-detalle" data-url="{% url 'detalle_transaccion_libromayor' m.codigo %}">
                                        Ver detalle
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                        <tfoot>
                            <tr class="fw-bold">
                                <td colspan="4" class="text-end">Saldo final:</td>
                                <td>{{ cuenta_data.saldo_final }}</td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
            {% endfor %}

        {% endfor %}
    {% endfor %}

    <!-- Modal de detalle -->
    <div id="detalleModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="detalleContenido">
                <!-- Contenido dinámico con JS -->
            </div>
        </div>
    </div>
</div>

<script src="{% static 'js/libromayor.js' %}"></script>
{% endblock %}