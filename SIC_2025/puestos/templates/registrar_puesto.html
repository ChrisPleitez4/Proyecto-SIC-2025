{% extends 'base.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static '/puestos.css' %}">

<div class="form-container">
  <h2>Registro de Puesto</h2>

  <form method="POST">
    {% csrf_token %}
    <div class="form-columns">
      <div class="column">
        <label>Nombre:</label>
        <input type="text" name="nombre" required value="{{ nombre }}">

        <label>Salario Nominal Diario:</label>
        <input type="number" name="salario" step="0.01" min="0.01" required value="{{ salario }}" oninput="validarDecimales(this)">

        <label>Eficiencia (0–1):</label>
        <input type="number" name="eficiencia" step="0.01" min="0.01" max="1" required value="{{ eficiencia }}" oninput="validarDecimales(this)">
      </div>

      <div class="column info">
        <h3>Prestaciones</h3>
        <p><strong>Días Vacaciones:</strong> {{ dias_vacaciones }}</p>
        <p><strong>Recargo Vacaciones:</strong> {{ recargo_vacaciones }}</p>
        <p><strong>Días Aguinaldo:</strong> {{ dias_aguinaldo }}</p>
      </div>
    </div>

    <div class="form-actions">
      <button type="submit" name="calcular" class="btn calcular">Calcular Costo Real</button>
      <button type="submit" name="registrar" class="btn guardar">Registrar Puesto</button>
    </div>
  </form>

  {% if resultado %}
  <div class="result-section">
    <h3>Detalle de Cálculo</h3>
    <table class="styled-table">
      <tr><th>Descripción</th><th>Monto</th></tr>
      {% for k, v in resultado.items %}
      <tr><td>{{ k }}</td><td>${{ v }}</td></tr>
      {% endfor %}
    </table>
  </div>
  {% endif %}

  <div class="puestos-section">
    <h3>Puestos Actuales</h3>
    <table class="styled-table">
      <tr><th>Nombre</th><th>Salario por Hora</th><th>Salario por Día</th><th>Salario por Mes</th></tr>
      {% for p in puestos %}
      <tr>
        <td>{{ p.nombrePuesto }}</td>
        <td>${{ p.salarioHoraPuesto|floatformat:2 }}</td>
        <td>${{ p.salarioDiarioPuesto|floatformat:2 }}</td>
        <td>${{ p.salarioMesPuesto|floatformat:2 }}</td>
      </tr>
      {% endfor %}
    </table>
  </div>
</div>
<script>
function validarDecimales(input) {
    // Limita a 2 decimales
    const valor = input.value;
    if (valor.includes('.')) {
        const [entero, decimales] = valor.split('.');
        if (decimales.length > 2) {
            input.value = `${entero}.${decimales.slice(0, 2)}`;
        }
    }
}
</script>
{% endblock %}
