{% extends 'base.html' %}
{% block title %}Estimación de costo de venta{% endblock %}
{% load static %}

{% block content %}
<div class="container mt-4">
    <h3 class="mb-3">Cálculo de costo de venta estimado</h3>

    <div class="mb-3">
        <label for="horas_persona" class="form-label">Cantidad de horas por persona:</label>
        <input type="number" id="horas_persona" class="form-control w-25" min="1" value="1">
    </div>

    <div class="mb-3">
        <button class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#modalPuesto">Agregar puesto</button>
        <button class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#modalCif">Agregar CIF</button>
    </div>

    <!-- Tablas -->
    <div class="row">
        <div class="col-md-8">
            <h5>Mano de obra</h5>
            <table class="table table-bordered" id="tablaPuestos">
                <thead class="table-light">
                    <tr>
                        <th>Puesto</th>
                        <th>Cantidad de personas</th>
                        <th>Costo/hora</th>
                        <th>Costo total</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>

            <h5>CIF</h5>
            <table class="table table-bordered" id="tablaCif">
                <thead class="table-light">
                    <tr>
                        <th>Descripción</th>
                        <th>Costo</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <div class="col-md-4">
            <div class="card p-3">
                <p><b>Tasa CIF:</b> $<span id="tasa_cif_pro">0.00</span></p>
                <p><b>Total CIF:</b> $<span id="total_cif">0.00</span></p>
                <p><b>Variación (30%):</b> $<span id="variacion">0.00</span></p>
                <p><b>Utilidad (25%):</b> $<span id="utilidad">0.00</span></p>
            </div>
        </div>
    </div>

    <div class="mt-3">
        <p><b>Costo de producción:</b> $<span id="costo_produccion">0.00</span></p>
        <p><b>Precio de venta:</b> $<span id="costo_venta">0.00</span></p>
        <p><b>Anticipo (25%):</b> $<span id="anticipo">0.00</span></p>
        <button id="guardarAnticipo" class="btn btn-success">Guardar anticipo</button>
    </div>
</div>

<!-- Modal Puesto -->
<div class="modal fade" id="modalPuesto" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header"><h5>Agregar Puesto</h5></div>
      <div class="modal-body">
        <label>Puesto:</label>
        <select id="puestoSelect" class="form-select">
          <option value="">Seleccione...</option>
          {% for p in puestos %}
            <option value="{{ p.idPuesto }}" data-salario="{{ p.salarioHoraPuesto }}">{{ p.nombrePuesto }}</option>
          {% endfor %}
        </select>

        <label class="mt-2">Salario por hora:</label>
        <input type="number" id="salarioHora" class="form-control" readonly>

        <label class="mt-2">Cantidad de personas:</label>
        <input type="number" id="cantidadPersonas" class="form-control" min="1">
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        <button id="btnAgregarPuesto" class="btn btn-primary">Agregar</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal CIF -->
<div class="modal fade" id="modalCif" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header"><h5>Agregar CIF</h5></div>
      <div class="modal-body">
        <label>Descripción:</label>
        <input type="text" id="descripcionCif" class="form-control">

        <label class="mt-2">Monto:</label>
        <input type="number" id="montoCif" class="form-control" step="0.01" min="0">
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        <button id="btnAgregarCif" class="btn btn-primary">Agregar</button>
      </div>
    </div>
  </div>
</div>

<script src="{% static '/js/calcular.js' %}"></script>
{% endblock %}